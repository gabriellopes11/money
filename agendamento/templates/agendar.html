<!DOCTYPE html>
<html>
<head>
    <title>Agendamento</title>
</head>
<body>
<h2>Agendar horário</h2>

<form method="post">
    {% csrf_token %}

    <input type="text" name="nome" placeholder="Seu nome" required value="{{ request.POST.nome }}"><br><br>
    <input type="text" name="telefone" placeholder="Telefone" required value="{{ request.POST.telefone }}"><br><br>

    <select name="servico" required>
        {% for s in servicos %}
            <option value="{{ s.id }}" {% if request.POST.servico == s.id|stringformat:"s" %}selected{% endif %}>{{ s.nome }}</option>
        {% endfor %}
    </select><br><br>

    <select name="profissional">
        <option value="">Qualquer profissional</option>
        {% for p in profissionais %}
            <option value="{{ p.id }}" {% if request.POST.profissional == p.id|stringformat:"s" %}selected{% endif %}>{{ p.nome }}</option>
        {% endfor %}
    </select><br><br>

    <input type="date" name="data" required value="{{ request.POST.data }}"><br><br>

    <button type="submit" name="buscar">Buscar horários</button>
</form>

{% if horarios %}
<form method="post">
    {% csrf_token %}
    <input type="hidden" name="nome" value="{{ request.POST.nome }}">
    <input type="hidden" name="telefone" value="{{ request.POST.telefone }}">
    <input type="hidden" name="servico" value="{{ request.POST.servico }}">
    <input type="hidden" name="profissional" value="{{ request.POST.profissional }}">
    <input type="hidden" name="data" value="{{ request.POST.data }}">

    <br><br>
    <select name="hora" required>
        {% for h in horarios %}
            <option value="{{ h|time:"H:i" }}">{{ h|time:"H:i" }}</option>
        {% endfor %}
    </select><br><br>

    <button type="submit" name="agendar">Confirmar agendamento</button>
</form>
{% endif %}
